<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRIJAN's Home of Cricket - SA20 Squads</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Electrolize&family=Oswald:wght@200..700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Electrolize', sans-serif;
            /* Using SA20-themed colors: Green/Yellow for SA, dark blue/red */
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%);
            min-height: 100vh;
            color: #fff;
        }

        /* Header Styles - Changed to Green/Gold SA20 theme */
        .header {
            background: linear-gradient(90deg, #008855 0%, #00aa66 50%, #ffd700 100%);
            padding: 10px 0;
            box-shadow: 0 4px 12px rgba(0, 136, 85, 0.5);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .home-logo {
            width: 40px;
            height: 40px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .home-logo:hover {
            transform: scale(1.1) rotate(360deg);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            flex-grow: 1;
            text-align: center;
            color: #0a0e27; /* Dark text for SA20 header */
        }

        /* Navigation buttons styles */
        .nav-buttons {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            text-align: center;
            max-width: 1400px;
            margin: 15px auto;
        }
        
        /* Renaming the class from .ipl-year-btn to .sa20-year-btn */
        .sa20-year-btn {
            background: linear-gradient(135deg, #1a1f3a 0%, #2a2f4a 100%);
            color: #ffd700; /* Gold text */
            border: 2px solid #ffd700;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .sa20-year-btn:hover {
            background: #ffd700;
            color: #0a0e27;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        .sa20-year-btn.active {
            background: #00ff88;
            color: #0a0e27;
            border-color: #00ff88;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Team Card Styles */
        .team-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #2a2f4a 100%);
            border: 2px solid #ffd700; /* Gold border */
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            animation: fadeIn 0.6s ease-in-out;
        }

        .team-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.5);
            border-color: #00ff88;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .team-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ffd700; /* Gold separator */
        }

        .team-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #00ff88; /* Bright green name */
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Image Styles */
        .team-logo-img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            display: block;
            margin: 0 auto 15px;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.5));
        }

        .role-icon-img {
            width: 20px;
            height: 20px;
            object-fit: contain;
            vertical-align: middle;
        }

        /* Player List */
        .player-list {
            list-style: none;
            padding: 0;
        }

        .player-item {
            background: rgba(255, 215, 0, 0.1); /* Light Gold background */
            padding: 5px 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .player-item:hover {
            background: rgba(255, 215, 0, 0.2);
            border-left-color: #00ff88;
            transform: translateX(5px);
        }

        .player-item.impact-player {
            background: rgba(255, 0, 0, 0.15); /* Red for impact */
            border: 1px solid #ff4444;
        }

        .player-number {
            background: #ffd700; /* Gold number background */
            color: #0a0e27;
            font-weight: 700;
            padding: 2px 5px;
            border-radius: 4px;
            min-width: 30px;
            font-size: 0.75rem;
            text-align: center;
        }

        .player-item.impact-player .player-number {
            background: #ff4444;
            color: #fff;
        }

        .player-name {
            flex-grow: 1;
            font-size: 0.8rem;
            line-height: 1.2;
        }

        .icon-placeholder {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .airplane-icon {
            background: #ff4444;
        }

        /* Footer */
        .footer {
            background: linear-gradient(90deg, #ffd700 0%, #00aa66 50%, #008855 100%);
            padding: 30px 0;
            margin-top: 60px;
            text-align: center;
            box-shadow: 0 -4px 20px rgba(255, 215, 0, 0.5);
            color: #0a0e27;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-title {
                font-size: 1.5rem;
            }

            .team-card {
                margin-bottom: 20px;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="home-logo" onclick="goHome()">
                üèè
            </div>
            <h1 class="header-title">SRIJAN's Home of Cricket - SA20</h1>
        </div>
    </header>

    <div class="nav-buttons">
        <a href="sa20squads.html?year=2023" class="sa20-year-btn">SA20 2023</a>
        <a href="sa20squads.html?year=2024" class="sa20-year-btn">SA20 2024</a>
        <a href="sa20squads.html?year=2025" class="sa20-year-btn">SA20 2025</a>
        <a href="sa20squads.html?year=2026" class="sa20-year-btn">SA20 2026</a>
    </div>

    <div class="main-content">
        <div class="row" id="teams-container">
            <div class="loading-message" style="text-align: center; color: #ffd700; padding: 50px; font-size: 24px;">
                Loading Teams Data...
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 SRIJAN's Home of Cricket. All Rights Reserved.</p>
            <p>üèè Official SA20 Team Rosters üèÜ</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        const roleIcons = {
            'BATTER': 'images/batter.png',
            'BOWLER': 'images/bowler.png',
            'WICKET KEEPER': 'images/wkt.png',
            'ALL ROUNDER': 'images/allrounder.png'
        };

        function goHome() {
            window.location.href = "index.html";
        }

        /**
         * Utility function to get a query parameter from the URL.
         */
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // PARSER: Uses the same robust CSV parsing logic
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const data = [];

            let currentTeam = "";

            // Start from 1 to skip header
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;

                // Split by comma
                const values = lines[i].split(',').map(v => v.trim());

                // We expect at least 5 columns: Team(0), Number(1), Name(2), Overseas(3), Role(4)
                if (values.length < 5) continue;

                // FILL DOWN LOGIC: If team name is present, update currentTeam. 
                // If empty, use the previous currentTeam.
                if (values[0] !== "") {
                    currentTeam = values[0];
                }

                const row = {
                    'Team': currentTeam,
                    'Name': values[2], // Column 2 is Name
                    'Overseas': values[3], // Column 3 is Overseas status
                    'Role': values[4] // Column 4 is Role
                };

                if (row['Name'] && row['Team']) {
                    data.push(row);
                }
            }
            return data;
        }

        function groupPlayersByTeam(players) {
            const teams = {};
            players.forEach(player => {
                const teamName = player['Team'];
                if (!teams[teamName]) {
                    teams[teamName] = [];
                }
                teams[teamName].push(player);
            });
            return teams;
        }

        function getRoleIconPath(role) {
            const normalizedRole = role ? role.trim().toUpperCase() : '';
            return roleIcons[normalizedRole] || '';
        }

        function createTeamCard(teamName, players) {
            const card = document.createElement('div');
            card.className = 'col-lg-3 col-md-4 col-sm-6';

            let displayNameHTML = teamName; 

            // Generic Team Name Formatting Logic: split multi-word names for two lines
            const firstSpaceIndex = teamName.indexOf(' ');
            if (firstSpaceIndex !== -1) {
                const firstWord = teamName.substring(0, firstSpaceIndex);
                const restOfName = teamName.substring(firstSpaceIndex + 1);
                displayNameHTML = `${firstWord}<br>${restOfName}`;
            }
            // End Team Name Formatting Logic

            let playersHTML = '';
            players.forEach((player, index) => {
                // Player numbers 1-11 are starters, index 11+ are Impact/Reserves
                const playerNumber = index < 11 ? index + 1 : 'Impact'; 
                const isOverseas = player['Overseas'] && player['Overseas'].toUpperCase() === 'OVS';

                const airplaneIcon = isOverseas ? '<span class="icon-placeholder airplane-icon">‚úàÔ∏è</span>' : '';

                const roleIconPath = getRoleIconPath(player['Role']);

                const roleImgTag = roleIconPath
                    ? `<img src="${roleIconPath}" class="role-icon-img" alt="${player['Role']}">`
                    : '<span class="icon-placeholder role-icon">üèè</span>';

                playersHTML += `
                    <li class="player-item ${index >= 11 ? 'impact-player' : ''}">
                        <span class="player-number">${playerNumber === 'Impact' ? 'IMPACT' : playerNumber}</span>
                        <span class="player-name">${player['Name'] || 'Unknown Player'}</span>
                        ${airplaneIcon}
                        ${roleImgTag}
                    </li>
                `;
            });

            card.innerHTML = `
                <div class="team-card">
                    <div class="team-header">
                        <div class="team-name" style="line-height: 1.2;">${displayNameHTML}</div>
                    </div>
                    <ul class="player-list">
                        ${playersHTML}
                    </ul>
                </div>
            `;

            return card;
        }

        async function loadTeamsData() {
            // 1. Get the current year from the URL parameter. Default to 2026 if not found.
            const iplYear = getUrlParameter('year') || '2026'; 
            
            // 2. CONSTRUCT THE CSV FILENAME DYNAMICALLY: This is the key change from IPL
            const filename = `sa${iplYear}.csv`; 

            document.querySelector('.loading-message').textContent = `Loading SA20 ${iplYear} Teams Data...`;

            try {
                const response = await fetch(filename);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} for file ${filename}`);
                }

                const csvText = await response.text();
                const players = parseCSV(csvText);
                const teams = groupPlayersByTeam(players);

                const container = document.getElementById('teams-container');
                container.innerHTML = ''; // Clear loading message/previous data

                const sortedTeamNames = Object.keys(teams).sort();

                if (sortedTeamNames.length === 0) {
                     container.innerHTML = `
                        <div style="text-align: center; color: #ffd700; padding: 50px; font-size: 20px;">
                            No teams found in <strong>${filename}</strong>. The CSV file may be empty or incorrectly formatted.
                        </div>
                    `;
                    return;
                }

                sortedTeamNames.forEach(teamName => {
                    const teamCard = createTeamCard(teamName, teams[teamName]);
                    container.appendChild(teamCard);
                });

            } catch (error) {
                console.error(`[Load Error] Error loading CSV: ${filename}`, error);
                document.getElementById('teams-container').innerHTML = `
                    <div style="text-align: center; color: #ff4444; padding: 50px; font-size: 20px;">
                        Error loading teams data for SA20 ${iplYear}: ${error.message}<br>
                        Please ensure <strong>${filename}</strong> is correctly placed in the directory.
                    </div>
                `;
            }
        }

        function highlightCurrentPage() {
            // Get the active year from the URL parameter
            const activeYear = getUrlParameter('year');

            if (!activeYear) return;

            // Targeting the new button class: .sa20-year-btn
            const navLinks = document.querySelectorAll('.sa20-year-btn');

            navLinks.forEach(link => {
                // Extract the year from the link's href (e.g., '2025' from 'sa20squads.html?year=2025')
                const linkYearMatch = link.getAttribute('href').match(/year=(\d{4})/);
                const linkYear = linkYearMatch ? linkYearMatch[1] : null;

                // Compare the active year with the link year
                if (linkYear === activeYear) {
                    link.classList.add('active');
                    // Scroll the active button into view
                    link.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                } else {
                    link.classList.remove('active');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadTeamsData();
            highlightCurrentPage(); 
        });
    </script>
</body>

</html>